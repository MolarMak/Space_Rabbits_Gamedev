# Space_Rabbits_Gamedev

<h3><b>Онлайн режим</b></h3>

<b>Задача</b>

Необхідно реалізувати можливість системи створювати ігрові кімнати, щоб гравці могли приєднатися до них, отримати однакові запитання, відслідковувати відповіді кожного із гравця і нараховувати бали відповідно до відповідей. 
Також система має вміти вираховувати результати гри між гравцями і видавати відповідно: виграш, програш або нічию між ними, відповідно до цього нараховувати ігрові бали.

<b>Рішення</b>

<i>Загальний підхід</i>

При першому запиті гравця на онлайн гру створювати запис стану гри, так звану ігрову «кімнату», у базу даних із посиланням на цього гравця, як учасника. Із кожним наступним гравцем, система має перевіряти усі доступні вільні місця у ігрових «кімнатах», що є попередньо створеними станами гри попередніми гравцями, і якщо є вільні місця, тобто коли до кімнати долучений лише один гравець, а не два, то додавати до кімнати другого. Якщо в момент часу, коли новий гравець створює запит на онлайн гру, немає жодного вільного місця у кімнатах, то створювати нову кімнату. 
Після створення і заповнення ігрової кімнати, далі за допомогою технології вебсокетів підтримувати постійний двусторонній зв'язок між сервером та гравцями.
Гравці відповідаючи на питання, роблять запит по каналу зв’язку і в цей час, стан гри у базі даних обновляється, усі оновлення розсилаються по каналам зв’язку всім гравцям.
Після завершення гри система визначає переможця, або нічию, нараховує бали та посилає повідомлення про закінчення гри усім гравцям. Після цього система від’єднує гравців від кімнати і видає запис про стан гри із бази даних. 

<i>Вирахування переможця</i>

Кожен із гравців отримує по 5 однакових, але абсолютно випадкових питань  із загального списку.  Вони можуть бути як правильними, так і не правильними. Якщо  питання правильне і гравець обирає «так» то він отримує 1 бал, якщо питання не правильне і гравець обирає «ні» то він також отримує 1 бал. У всіх інших випадках бали не нараховується. Під кінець, коли обидва гравці відповіли на свої запитання, бали підраховуються і гравці дізнаються результат: виграш, програш або нічия. Гравець, котрий набрав більшу кількість балів у підсумку,    отримує  виграш, менше – програш, а якщо обидва гравці набрали порівну то нічию. 

<i>Технічне рішення</i>

При розробці мульплеера ми використовували технологію вебсокетів. При приєднанні гравця в кімнату йому у відповідність ставиться Actor, потокобезпечний об'єкт, який знаходиться в Actor System, за фактом в пулл об'єктів, і може комунікувати з іншими Actors за допомогою передачі та отримання повідомлень. Таким чином, ми маємо практично наочно уявлення про архітектуру, як про систему, де користувачі представлені об'єктами і спілкуються між собою. Стану онлайн ігри в кожен момент часу оновлюється кожним з Actors (оновлюється запис в БД), а також передаються сполучення між Actors, які потрапляють до прив'язаному до нього користувачеві. 

<i>Переваги</i>

Потокобезпечна система, із зрозумілими абстракціями і методами комунікації між ними. Висока швидкість роботи і обробки запитів.

<i>Недоліки</i>

Можливість збоїв у вебсокет комунікації між клієнтом та сервером, що може призвести до ефекту “замороження” гри, коли система очікує повторного під’єднання клієнту.
 
<i>Проблеми, що виникли у ході їх рішення</i> 

Вебсокет з’єднання та багато можливих станів об’єкту ігрової кімнати створюють підвищенну складність до написання юніт та інтеграційних тестів, що призводить то зменшення темпів розробки та збільшує вірогідність допущення помилок. 
 
<h3><b>Синхронізація на клієнті</b></h3>

<b>Задача</b>

...

<b>Рішення</b>

<i>Загальний підхід</i>

...

<i>Вирахування переможця</i>

...

<i>Загальний підхід</i>

...

<i>Технічне рішення</i>

...

<i>Переваги</i>

...

<i>Недоліки</i>

...

<i>Проблеми, що виникли у ході їх рішення</i>

...
